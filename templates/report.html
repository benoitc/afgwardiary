<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/> 
    <title>Kabul War Diary</title>
    <link href='{{ assetPath }}/gfx/favicon.ico' rel='shortcut icon'>
    <link href='{{ assetPath }}/css/reset-fonts-grids.css' rel='stylesheet' type='text/css'>
    <link href='{{ assetPath }}/css/reports.css' rel='stylesheet' type='text/css'>
    <script src='{{ assetPath }}/js/modernizr-1.5.min.js' type='text/javascript' type='text/javascript'></script>
    <script src='http://maps.google.com/maps/api/js?sensor=false' type='text/javascript'></script>
    <script src='{{ assetPath}}/js/afg_map.js' type='text/javascript'></script> 
    <script type='text/javascript'> 
      //<![CDATA[
        function initialize( ) {
            initialize_map( );
            {{#doc}}
        	marker = new google.maps.Marker({ position: new
                    google.maps.LatLng( {{Latitude}}, {{Longitude}} ),
                    map: window.map, title: '( {{Type}}) {{Title}}'});
        	google.maps.event.addListener(marker, 'click', function( ){
                    document.location.href = document.location.href; });
            window.map.setCenter( new google.maps.LatLng( {{Latitude}}, {{Longitude}} ) );
            {{/doc}}
        }
      //]]>
    </script>
</head>
  <body onload="initialize()">
    <sidebar class="small pane">
        <a href='{{ assetPath }}/index.html'><img alt='WikiLeaks logo'
            src='{{ assetPath }}/gfx/WL_Hour_Glass_small.png'></a>
        <div><h3>Browse by <a id="type" href="#"
                    class="browse">Type</a></h3></div>
        <div><h3>Browse by <a id="category" href="#"
                    class="browse">Category</a></h3></div>
        <div><h3>Browse by <a id="region" href="#"
                    class="browse">Region</a></h3></div>
        <div><h3>Browse by <a id="affiliation" href="#"
                    class="browse">Affiliation</a></h3></div>
        <div><h3>Browse by <a id="date" href="#"
                    class="browse">Date</a></h3></div>
    </sidebar>
    <section class='pane big'>
        {{#doc}}
        <h3>{{Type}} {{Title}}</h3>
        <table class="report r2">
            <tr>
                <th>Reference ID</th>
                <th>Region</th>
                <th>Latitude</th>
                <th>Longitude</th>
            </tr>
            <tr>
                <td>{{ _id }}</td>
                <td>{{ Region}} </td>
                <td>{{Latitude}}</td>
                <td>{{Longitude}}</td>
            </tr>
        </table>
        <table class="report r1">
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Affiliation</th>
                <th>Detained</th>
            </tr>
            <tr>
                <td>{{ Date }}</td>
                <td>{{ Type }} </td>
                <td>{{ Affiliation }}</td>
                <td>{{ EnemyDetained }}</td>
            </tr>
        </table>

         <table class="report r3">
             <tr>
                 <th></th>
                <th>Ennemy</th>
                <th>Friend</th>
                <th>Civilian</th>
                <th>Host nation</th>
            </tr>
            <tr>
                <th>Killed In Action</th>
                <td>{{ EnemyKIA }}</td>
                <td>{{ EnemyKIA }}</td>
                <td>{{ CivilianKIA }}</td>
                <td>{{ HostNationKIA }}</td>
            </tr>
            <tr>
                <th>Wounded In Action</th>
                <td>{{ EnemyWIA }}</td>
                <td>{{ FriendlyWIA }}</td>
                <td>{{ CivilianWIA }}</td>
                <td>{{ HostNationWIA }}</td>
            </tr>
        </table>

        <code>
        <code>
            <pre>{{ Summary }}</pre>
        </code>
        <code>
            <pre>
Report key: {{ _id }}
Tracking number: {{ TrackingNumber }}
Attack on: {{ AttackOn }}
Complex attack: {{ ComplexAttack }}
Reporting unit: {{ ReportingUnit }}
Unit name: {{ UnitName }}
Type of unit: {{ TypeOfUnit }}
Originator group: {{ OriginatorGroup }}
Updated by group: {{ UpdatedByGroup }}
MGRS: {{ MGRS }}
CCIR: {{ CCIR }}
Sigact:  {{ Sigact }}
DColor: {{ DColor }} 
            </pre>
        </code>
        <div class='overMap'> 
        <div id='mapOverlay' style="background: url(
            'http://maps.google.com/maps/api/staticmap?center=&amp;zoom=16&amp;size=650x300&amp;maptype=hybrid&amp;markers=color:blue|{{Latitude}},{{Longitude}}&amp;sensor=false' ) center no-repeat;"></div> 
      </div>  
        
        {{/doc}}
    
    </section>

  </body>
  <script src="/_utils/script/sha1.js"></script>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js"></script>
  <script src="/_utils/script/jquery.couch.js"></script>
  <script src="{{assetPath}}/vendor/couchapp/jquery.couch.app.js"></script>
  <script src="{{assetPath}}/vendor/couchapp/jquery.couch.app.util.js"></script>
  <script src="{{assetPath}}/vendor/couchapp/jquery.mustache.js"></script>
  <script src="{{assetPath}}/vendor/couchapp/jquery.evently.js"></script>


  <script type="text/javascript" charset="utf-8">
      var assetPath = "{{ assetPath }}";

      $.couch.app(function(app) {
        var makePath = app.require("vendor/couchapp/lib/path").makePath;

        $(".browse").bind("click", function(e) {
            e.preventDefault();

            var viewName = $(this).attr("id");
            var templates = app.ddoc.templates;
            
            var obj = $(this);

            if (obj.hasClass("toggle")) {
                obj.parent().parent().find('.cbrowse').detach() 
                obj.removeClass("toggle");
                return;
            }
           
            is_browse = $(".cbrowse");
            if (is_browse.length > 0) {
                is_browse.parent().find("a").removeClass("toggle");
                $(is_browse).detach();
            }

            obj.addClass("toggle");
            app.view(viewName, {
                group: true,
                success: function(data) {
                    var cnt = $.mustache(templates.browseBox, {
                        links: data.rows.map(function(r) {
                            var link = makePath(["..", "..", "_list", "browse",
                                "by_" + viewName, {
                                    startkey: [r.key],
                                    endkey: [r.key, {}],
                                    limit: 10,
                                    include_docs: true,
                            }]); 
                            return {
                                name: r.key,
                                nb: r.value,
                                link: link 
                            };
                        
                        })
                    });

                    var ul = $(cnt);
                    obj.parent().parent().after().append(ul);
                
                }
            });
            
            return false;
        });        
      });
</script>
</html> 
